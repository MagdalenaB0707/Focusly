<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Courses</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <!-- Add form -->
  <ion-item>
    <ion-input
      label="Title"
      labelPlacement="stacked"
      placeholder="e.g. Databases, Web Programming..."
      [(ngModel)]="form.title"
    ></ion-input>
  </ion-item>

  <ion-item>
    <ion-textarea
      label="Description (optional)"
      labelPlacement="stacked"
      placeholder="Short note..."
      autoGrow="true"
      [(ngModel)]="form.description"
    ></ion-textarea>
  </ion-item>

  <ion-item>
    <ion-input
      label="Estimated time (minutes, optional)"
      labelPlacement="stacked"
      type="number"
      placeholder="e.g. 90"
      [(ngModel)]="form.estimatedTime"
    ></ion-input>
  </ion-item>

  <ion-button expand="block" (click)="createCourse()" [disabled]="saving">
    {{ saving ? 'Saving...' : 'Add course' }}
  </ion-button>

  <ion-note color="danger" *ngIf="uiError" style="display:block; margin-top:10px;">
    {{ uiError }}
  </ion-note>

  <hr style="margin: 16px 0; opacity: 0.2;" />

  <!-- Loading -->
  <div *ngIf="loading" style="display:flex; justify-content:center; padding: 16px 0;">
    <ion-spinner></ion-spinner>
  </div>

  <!-- Empty -->
  <ion-note *ngIf="!loading && !uiError && courses.length === 0" style="display:block;">
    No courses yet.
  </ion-note>

  <!-- List -->
  <ion-list *ngIf="!loading && !uiError && courses.length > 0">

    <ion-item *ngFor="let c of courses; trackBy: trackByCourseId" lines="full">
      <ion-label>

        <!-- Normal view -->
        <ng-container *ngIf="editingId !== c.id; else editTpl">
          <h2>{{ c.title }}</h2>
          <p *ngIf="c.description">{{ c.description }}</p>
          <p *ngIf="c.estimatedTime != null">Estimated: {{ c.estimatedTime }} min</p>
        </ng-container>

        <!-- Edit view -->
        <ng-template #editTpl>
          <ion-item lines="none">
            <ion-input
              label="Title"
              labelPlacement="stacked"
              [(ngModel)]="editForm.title"
            ></ion-input>
          </ion-item>

          <ion-item lines="none">
            <ion-textarea
              label="Description"
              labelPlacement="stacked"
              autoGrow="true"
              [(ngModel)]="editForm.description"
            ></ion-textarea>
          </ion-item>

          <ion-item lines="none">
            <ion-input
              label="Estimated time (minutes)"
              labelPlacement="stacked"
              type="number"
              [(ngModel)]="editForm.estimatedTime"
            ></ion-input>
          </ion-item>

          <div style="display:flex; gap:8px; margin-top:8px;">
            <ion-button size="small" (click)="saveEdit(c)" [disabled]="updating">
              {{ updating ? 'Saving...' : 'Save' }}
            </ion-button>

            <ion-button size="small" fill="outline" (click)="cancelEdit()" [disabled]="updating">
              Cancel
            </ion-button>
          </div>
        </ng-template>

      </ion-label>

      <!-- Right buttons -->
      <ion-button
        slot="end"
        fill="clear"
        (click)="startEdit(c)"
        [disabled]="editingId === c.id || deletingId === c.id"
      >
        Edit
      </ion-button>

      <ion-button
        slot="end"
        fill="clear"
        color="danger"
        (click)="deleteCourse(c.id)"
        [disabled]="deletingId === c.id || editingId === c.id"
      >
        {{ deletingId === c.id ? '...' : 'Delete' }}
      </ion-button>

    </ion-item>

  </ion-list>

</ion-content>
