<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Activities</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <!-- Add form -->
  <ion-item>
    <ion-input
      label="Title"
      labelPlacement="stacked"
      placeholder="e.g. Reading, Coding, Gym..."
      [(ngModel)]="form.title"
    ></ion-input>
  </ion-item>

  <ion-item>
    <ion-textarea
      label="Description (optional)"
      labelPlacement="stacked"
      placeholder="Short note..."
      autoGrow="true"
      [(ngModel)]="form.description"
    ></ion-textarea>
  </ion-item>

  <ion-button expand="block" (click)="createActivity()" [disabled]="saving">
    {{ saving ? 'Saving...' : 'Add activity' }}
  </ion-button>

  <ion-note
    color="danger"
    *ngIf="uiError"
    style="display: block; margin-top: 10px"
  >
    {{ uiError }}
  </ion-note>

  <hr style="margin: 16px 0; opacity: 0.2" />

  <!-- Loading -->
  <div
    *ngIf="loading"
    style="display: flex; justify-content: center; padding: 16px 0"
  >
    <ion-spinner></ion-spinner>
  </div>

  <!-- Empty -->
  <ion-note
    *ngIf="!loading && !uiError && activities.length === 0"
    style="display: block"
  >
    No activities yet.
  </ion-note>

  <!-- List -->
  <ion-list *ngIf="!loading && !uiError && activities.length > 0">
    <ion-item
      *ngFor="let a of activities; trackBy: trackByActivityId"
      lines="full"
    >
      <ion-label>
        <!-- Normal view -->
        <ng-container *ngIf="editingId !== a.id; else editTpl">
          <h2>{{ a.title }}</h2>
          <p *ngIf="a.description">{{ a.description }}</p>
        </ng-container>

        <!-- Edit view -->
        <ng-template #editTpl>
          <ion-item lines="none">
            <ion-input
              label="Title"
              labelPlacement="stacked"
              [(ngModel)]="editForm.title"
            ></ion-input>
          </ion-item>

          <ion-item lines="none">
            <ion-textarea
              label="Description"
              labelPlacement="stacked"
              autoGrow="true"
              [(ngModel)]="editForm.description"
            ></ion-textarea>
          </ion-item>

          <div style="display: flex; gap: 8px; margin-top: 8px">
            <ion-button
              size="small"
              (click)="saveEdit(a)"
              [disabled]="updating"
            >
              {{ updating ? 'Saving...' : 'Save' }}
            </ion-button>

            <ion-button
              size="small"
              fill="outline"
              (click)="cancelEdit()"
              [disabled]="updating"
            >
              Cancel
            </ion-button>
          </div>
        </ng-template>
      </ion-label>

      <!-- Buttons on the right -->
      <ion-button
        slot="end"
        fill="clear"
        (click)="startEdit(a)"
        [disabled]="editingId === a.id || deletingId === a.id"
      >
        Edit
      </ion-button>

      <ion-button
        slot="end"
        fill="clear"
        color="danger"
        (click)="deleteActivity(a.id)"
        [disabled]="deletingId === a.id || editingId === a.id"
      >
        {{ deletingId === a.id ? '...' : 'Delete' }}
      </ion-button>
    </ion-item>
  </ion-list>
</ion-content>
